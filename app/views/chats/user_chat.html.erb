<div id="chat_page">

    <div id="chat_members">
        <div id="search_form">
            <%= form_with(url: chat_room_search_path, method: :post, local: true) do |f| %>
                <%= f.text_field :search_room, placeholder: "名前を入力してください", class: "chat_search_form form-control" %>
                <button type="submit" class="btn btn-primary chat_search_btn"> 
                     <span class="glyphicon glyphicon-search" aria-hidden="true"></span>
                </button> 
            <% end %>
        </div> 
        <% @chats.each do |chat| %>
            <%= link_to room_path(room_id: chat.room_id), remote:true, method: :post do %>
                <% @room = Room.find(chat.room_id) %>
                <div class="chat_rooms" id="chat_room_<%=@room.room_token%>">
                    <div class="inline_block">
                        <%= attachment_image_tag chat.hairdresser, :hairdresser_image, size: "70x70", fallback: "no_image.png", class: "img-circle chat_img" %>
                    </div>
                    <div class="inline_block" style="margin-left: 20px; width: 250px;">
                        <p style="color: black; font-size: 22px;"><%= chat.hairdresser.name %></p>
                        <% @last_message = ChatMessage.where(room_id: chat.room_id).last %>
                        <% if @last_message.present? %>
                            <% if 1 <= @last_message.message.length && @last_message.message.length <= 32 %>
                                <p class="chat_last_message chat_last_message_room_<%=@room.room_token%>"><%= @last_message.message %></p>
                            <% elsif 33 <= @last_message.message.length %>
                                <p class="chat_last_message chat_last_message_room_<%=@room.room_token%>"><%= @last_message.message[0..32] %>...</p>
                            <% else %>
                                <p class="chat_last_message chat_last_message_room_<%=@room.room_token%>">写真を送信しました</p>
                            <% end %>
                        <% end %>
                    </div>
                    <% @unread_number = ChatMessage.where(notification: false, room_id: chat.room_id, hairdresser_id: chat.hairdresser.id).length %>
                    <% if 1 <= @unread_number && @unread_number <= 99 %>
                        <div class="inline_block unread_number unread_number_<%=@room.room_token%>">
                            <p><%= @unread_number %></p>
                        </div>
                    <% elsif 100 <= @unread_number %>
                        <div class="inline_block unread_number unread_number_<%=@room.room_token%>">
                            <p>99+</p>
                        </div>
                    <% end %>
                </div>
            <% end %>
        <% end %>   
    </div>

    <div id="chat">
        <p class="instruction">チャットしたい相手を選択してください</p>
        <div class="chat_message display_none" id="messages">
        </div>
    </div>
    
</div>

<div class="dark_chat">
    <span class="glyphicon glyphicon-remove cursor dark_remove"></span>
</div>